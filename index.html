<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°æ€æ—¥è®° | æ¯å¤©è®°å½•ï¼Œæ”¹å˜å‘½è¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .settings-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
        }
        .content { padding: 30px; }
        .record-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
        }
        .record-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }
        .records-list h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
        }
        .record-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .record-time {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .record-content {
            color: #212529;
            line-height: 1.6;
            margin-bottom: 15px;
            min-height: 60px;
        }
        .record-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .record-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }
        .edit-btn { background: #ffc107; color: #212529; }
        .delete-btn { background: #dc3545; color: white; }
        .summary-section {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            border: 2px solid #667eea;
        }
        .summary-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .summary-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-height: 100px;
            margin-top: 10px;
            line-height: 1.6;
        }
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 14px;
            margin-top: 10px;
        }
        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="settings-btn" onclick="window.location.href='settings.html'">âš™ï¸ APIè®¾ç½®</button>
            <h1>âœ¨ å°æ€æ—¥è®° âœ¨</h1>
            <p>æ¯å¤©è®°å½•æƒ³æ³•ï¼Œè®©AIå¸®ä½ æ‰¾åˆ°å¯å˜ç°çš„è·¯å­</p>
        </div>

        <div class="content">
            <div class="record-section">
                <h2>ğŸ“ è®°å½•æ­¤åˆ»çš„æƒ³æ³•</h2>
                <textarea id="recordInput" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•ã€çµæ„Ÿæˆ–æ„Ÿæ‚Ÿ..."></textarea>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveRecord()">ğŸ’¾ ä¿å­˜è®°å½•</button>
                    <button class="btn btn-secondary" onclick="clearInput()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </div>

            <div class="summary-section">
                <h2>ğŸ¤– ä¸€é”®æ™ºèƒ½æ€»ç»“</h2>
                <button class="btn btn-primary" onclick="generateSummary()" style="width:100%;">ğŸš€ ç”Ÿæˆä»Šæ—¥æ€»ç»“ä¸å˜ç°å»ºè®®</button>
                <div id="summaryContent" class="summary-content">
                    <p style="color:#6c757d;">ç‚¹å‡»æŒ‰é’®ï¼ŒAIå°†å¸®ä½ åˆ†æä»Šå¤©çš„è®°å½•ï¼Œç”Ÿæˆå¯å˜ç°çš„å†…å®¹å»ºè®®...</p>
                </div>
                <div id="loading" class="loading" style="display:none;">ğŸ”„ AIæ­£åœ¨æ€è€ƒä¸­...</div>
            </div>

            <div class="records-list">
                <h2>ğŸ“š ä»Šæ—¥è®°å½•</h2>
                <div id="recordsContainer"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadRecords();
            loadSettings();
        });

        function loadSettings() {
            const saved = localStorage.getItem('xiaosiSettings');
            window.apiSettings = saved ? JSON.parse(saved) : {
                apiKey: '',
                apiModel: 'deepseek',
                apiUrl: 'https://api.deepseek.com/v1/chat/completions'
            };
        }

        function saveRecord() {
            const content = document.getElementById('recordInput').value.trim();
            if (!content) {
                alert('ğŸ“ è¯·è¾“å…¥è¦è®°å½•çš„å†…å®¹ï¼');
                return;
            }

            const now = new Date();
            const record = {
                id: Date.now(),
                content: content,
                timestamp: now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }),
                date: now.toLocaleDateString('zh-CN')
            };

            const records = JSON.parse(localStorage.getItem('xiaosiRecords') || '[]');
            records.unshift(record);
            localStorage.setItem('xiaosiRecords', JSON.stringify(records));

            document.getElementById('recordInput').value = '';
            loadRecords();
            alert('âœ… è®°å½•ä¿å­˜æˆåŠŸï¼');
        }

        function clearInput() {
            document.getElementById('recordInput').value = '';
        }

        function loadRecords() {
            const container = document.getElementById('recordsContainer');
            const records = JSON.parse(localStorage.getItem('xiaosiRecords') || '[]');
            const today = new Date().toLocaleDateString('zh-CN');
            const todayRecords = records.filter(r => r.date === today);
            
            if (todayRecords.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>ğŸ’­ è¿˜æ²¡æœ‰è®°å½•å‘¢ï¼Œå¼€å§‹è®°å½•ä½ çš„æƒ³æ³•å§ï¼</p></div>';
                return;
            }

            let html = '';
            todayRecords.forEach(r => {
                html += `
                    <div class="record-item">
                        <div class="record-time">ğŸ• ${r.timestamp}</div>
                        <div class="record-content">${r.content}</div>
                        <div class="record-actions">
                            <button class="record-btn edit-btn" onclick="editRecord(${r.id})">âœï¸ ç¼–è¾‘</button>
                            <button class="record-btn delete-btn" onclick="deleteRecord(${r.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function editRecord(id) {
            const records = JSON.parse(localStorage.getItem('xiaosiRecords') || '[]');
            const record = records.find(r => r.id == id);
            if (record) {
                const newContent = prompt('âœï¸ ç¼–è¾‘è®°å½•å†…å®¹ï¼š', record.content);
                if (newContent !== null && newContent.trim() !== '') {
                    record.content = newContent.trim();
                    localStorage.setItem('xiaosiRecords', JSON.stringify(records));
                    loadRecords();
                    alert('âœ… è®°å½•æ›´æ–°æˆåŠŸï¼');
                }
            }
        }

        function deleteRecord(id) {
            if (!confirm('ğŸ—‘ï¸ ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;
            let records = JSON.parse(localStorage.getItem('xiaosiRecords') || '[]');
            records = records.filter(r => r.id != id);
            localStorage.setItem('xiaosiRecords', JSON.stringify(records));
            loadRecords();
            alert('âœ… è®°å½•åˆ é™¤æˆåŠŸï¼');
        }

        async function generateSummary() {
            const records = JSON.parse(localStorage.getItem('xiaosiRecords') || '[]');
            const today = new Date().toLocaleDateString('zh-CN');
            const todayRecords = records.filter(r => r.date === today);
            
            if (todayRecords.length === 0) {
                alert('ğŸ’­ è¿˜æ²¡æœ‰ä»Šå¤©çš„è®°å½•å‘¢ï¼Œè¯·å…ˆè®°å½•ä¸€äº›æƒ³æ³•ï¼');
                return;
            }

            const summaryContent = document.getElementById('summaryContent');
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            summaryContent.innerHTML = '';

            try {
                const recordsText = todayRecords.map(r => r.content).join('\n\n');
                const prompt = `è¯·åˆ†æä»¥ä¸‹ä»Šå¤©çš„æ—¥è®°è®°å½•ï¼Œå¸®æˆ‘ç”Ÿæˆä¸€ä¸ªæ€»ç»“ï¼Œå¹¶æä¾›å¯å˜ç°çš„å†…å®¹å»ºè®®ï¼ˆæ¯”å¦‚vlogè„šæœ¬ã€æ–‡ç« ä¸»é¢˜ã€äº§å“åˆ›æ„ç­‰ï¼‰ï¼š

ä»Šå¤©çš„è®°å½•ï¼š
${recordsText}

è¯·æŒ‰ç…§ä»¥ä¸‹æ ¼å¼å›å¤ï¼š
1. ä»Šæ—¥æ€»ç»“ï¼šï¼ˆç®€è¦æ€»ç»“ä»Šå¤©çš„ä¸»è¦æƒ³æ³•å’Œæƒ…ç»ªï¼‰
2. å˜ç°å»ºè®®ï¼šï¼ˆæä¾›2-3ä¸ªå…·ä½“çš„å¯å˜ç°å†…å®¹åˆ›æ„ï¼ŒåŒ…æ‹¬å½¢å¼å’Œä¸»é¢˜ï¼‰
3. è¡ŒåŠ¨å»ºè®®ï¼šï¼ˆç»™å‡º1-2ä¸ªå…·ä½“çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®ï¼‰`;

                const response = await callAI(prompt);
                summaryContent.innerHTML = `<p>${response.replace(/\n/g, '<br>')}</p>`;
            } catch (error) {
                summaryContent.innerHTML = `<p style="color:#dc3545;">âŒ ${error.message}</p>`;
            } finally {
                loading.style.display = 'none';
            }
        }

        async function callAI(prompt) {
            if (!window.apiSettings || !window.apiSettings.apiKey) {
                throw new Error('è¯·å…ˆåœ¨è®¾ç½®é¡µé¢é…ç½®APIå¯†é’¥');
            }

            const res = await fetch(window.apiSettings.apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${window.apiSettings.apiKey}`
                },
                body: JSON.stringify({
                    model: window.apiSettings.apiModel || 'deepseek',
                    messages: [{role:'system',content:'ä½ æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·åˆ†ææ—¥è®°å¹¶æä¾›å»ºè®®çš„AIåŠ©æ‰‹ã€‚'},{role:'user',content:prompt}],
                    temperature: 0.7,
                    max_tokens: 1000
                })
            });

            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.error?.message || 'APIè°ƒç”¨å¤±è´¥');
            }

            const data = await res.json();
            return data.choices[0].message.content;
        }
    </script>
</body>
</html>